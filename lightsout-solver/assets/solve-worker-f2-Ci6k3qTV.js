(function(){"use strict";onmessage=o=>{const f=Array(o.data.boardSize**2);for(let e=0;e<o.data.boardSize**2;e++)f[e]=o.data.bitBoard&1<<e?1:0;try{const e=h(f),n=e.reduce((l,t)=>t.length<l.length?t:l,e[0]);postMessage({solutions:e,bestSolution:n,originalBitBoard:o.data.bitBoard})}catch(e){if(e instanceof Error){postMessage({error:e});return}postMessage({error:"Unhandled error: "+e})}};function c(o){const f=new Set;for(let e=0;e<o[0].length-1;e++)f.add(e);for(let e=0;e<o.length;e++)for(let n=0;n<o[0].length-1;n++)if(o[e][n]!==0){f.delete(n);break}return[...f]}function u(o,f){const e=structuredClone(o);for(const t of f)for(let r=0;r<o.length;r++)e[r][t[0]]=e[r][t[0]]&&t[1];const n=Array(e.length).fill(0);for(let t=0;t<e.length;t++){let r=0;for(let s=e[t].length-1;s>=0;s--)r+=e[t][s];r!==0&&(n[t]=(r-1)%2)}for(const t of f)t[1]&&(n[t[0]]=1);return n.map((t,r)=>t?r:-1).filter(t=>t!==-1)}function h(o){if(![4,9,16,25].includes(o.length))throw new Error("Board state must be a supported length.");const f=g(Math.sqrt(o.length));for(let t=0;t<o.length;t++)f[t].push(o[t]);if(i(f),!l(f))throw new Error("Board has no solution.");const e=[],n=c(f);for(let t=0;t<2**n.length;t++){const r=n.map((a,b)=>[a,t&1<<b?1:0]),s=u(f,r);e.push(s)}return e;function l(t){for(let r=t.length-1;r>=0;r--)for(let s=0;s<t[0].length;s++)if(t[r][s]!==0){if(s===t[0].length-1)return!1;break}return!0}}function g(o){const f=o**2,e=Array(f).fill(0),n=Array.from({length:f},()=>e.slice(0));for(let l=0;l<o;l++)for(let t=0;t<o;t++)n[l*o+t][l*o+t]=1,l>0&&(n[l*o+t][(l-1)*o+t]=1),l<o-1&&(n[l*o+t][(l+1)*o+t]=1),t>0&&(n[l*o+t][l*o+t-1]=1),t<o-1&&(n[l*o+t][l*o+t+1]=1);return n}function i(o){f(0,0);function f(l,t){for(let r=t;r<o[0].length;r++)for(let s=l;s<o.length;s++)if(o[s][r]!==0){const a=o[l];o[l]=o[s],o[s]=a,e(l,r),f(l+1,r+1);return}}function e(l,t){for(let r=0;r<o.length;r++)r!==l&&o[r][t]&&n(l,r)}function n(l,t){for(let r=0;r<o[0].length;r++)o[t][r]=(o[l][r]+o[t][r])%2}}})();
